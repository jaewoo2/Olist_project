# Olist 데이터 전처리 이력 보고서 (Raw → Processed_v2)

본 보고서는 `data/raw` 폴더의 원본 데이터가 어떠한 과정을 거쳐 `data/processed_v2` 폴더의 전처리 데이터로 변환되었는지 그 상세 이력과 주요 변경 사항을 기록합니다.

---

## 1. 개요
*   **목적:** 원본 데이터의 노이즈 제거, 데이터 품질 향상, 분석용 파생 변수 생성을 통한 데이터 시점 일치
*   **대상:** `data/raw/*.csv` → `data/processed_v2/*.csv`
*   **핵심 도구:** `notebooks/data_quality_analysis.ipynb` (전처리 로직의 근거)

---

## 2. 테이블별 주요 변경 사항 및 전처리 내역

### 🛒 olist_orders_dataset.csv (주문)
이 테이블은 가장 많은 변화가 있었으며, 분석의 정밀도를 위해 대폭적인 정제와 파생 변수 생성이 이루어졌습니다.

*   **행(Rows) 변화:** 99,441건 → 95,082건 (약 4.4% 감소)
    *   **상태 필터링:** 주문 상태가 `delivered`인 건만 유지 (분석 대상 한정).
    *   **결측치 제거:** 주문 승인일, 물류사 인계일, 고객 수령일이 누락된 행 제거.
    *   **논리적 오류 행 제거:** 배송 소요 시간이 음수(-)로 계산되는 논리적 오류 데이터(1,373건) 제거.
*   **열(Columns) 추가 (10개 파생 변수 생성):**
    *   `total_delivery_time`: 주문 ~ 고객 수령 소요 일수
    *   `seller_prep_time`: 결제 승인 ~ 물류사 인계 소요 일수
    *   `pure_shipping_time`: 물류사 인계 ~ 수령 소요 일수
    *   `delivery_accuracy`: 배송 예정일 대비 실제 수령일 차이 (양수면 조기 배송)
    *   `is_delayed`: 수령일이 예정일보다 늦었는지 여부 (Binary: 0/1)
    *   `delivery_speed_type`: 배송 속도 범주화 (Very Fast ~ Very Slow)
    *   `purchase_hour`, `purchase_dayofweek`, `purchase_month`: 구매 시점 기반 시간학 관련 분석용
    *   `is_weekend`: 주말 구매 여부
*   **데이터 타입 변경:** 날짜 관련 컬럼(8개)을 `object`에서 `datetime64` 타입으로 변환.

### 📦 olist_products_dataset.csv (상품)
데이터 누락을 보완하고 상품 특성 분석을 용이하게 정제하였습니다.

*   **결측치 처리:**
    *   `product_category_name`: NaN → **'unknown'**으로 대체.
    *   `product_name_lenght`, `product_description_lenght`, `product_photos_qty`: NaN → **0**으로 대체.
    *   수치형 메타데이터(무게, 길이 등): 결측치 2건을 각각의 **중앙값(Median)**으로 대체.
*   **행(Rows) 유지:** 32,951건 유지 (모든 상품이 판매 이력이 있음을 확인).

### ⭐ olist_order_reviews_dataset.csv (리뷰)
분석 시 데이터 뻥튀기를 방지하고 신뢰도를 제고하였습니다.

*   **중복 데이터 처리:** 동일한 주문(`order_id`)에 대해 중복 생성된 리뷰(551건)를 제거하고, 최신 리뷰 생성일 기준 1건만 남김 (**1주문 1리뷰 원칙** 적용).
*   **텍스트 정제:** 리뷰 내용이 없는 경우를 수용하며, 날짜 타입 보정 진행.

### 💳 olist_order_payments_dataset.csv (결제)
*   **논리 검토:** 상품가+배송비보다 결제 금액이 큰 '카드 할부 이자 포함 건'을 정상 데이터로 식별.
*   **특이 케이스 유지:** 1개 주문에 최대 29회까지 분할 결제된 '다중 바우처' 사용 건 유지.

---

## 3. 공통 전처리 규칙 (Global Policy)
1.  **날짜 형식 표준화:** 모든 테이블의 날짜/시간 컬럼을 `YYYY-MM-DD HH:MM:SS` 형식의 Datetime 객체로 통일.
2.  **컬럼명 유지:** 원본의 의미를 살리기 위해 가급적 기존 컬럼명을 유지하되, 파생 변수는 명확한 비즈니스 용어를 사용.
3.  **데이터 무결성:** 분석 시 결과가 왜곡될 수 있는 '비배송 주문' 및 '물리적으로 불가능한 시간차' 데이터를 원천 배제함.

---

## 4. 요약 결론
`processed_v2` 데이터셋은 위와 같은 정제 과정을 통해 **"분석 가능한 상태(Clean State)"**가 되었으며, 특히 `orders` 테이블에 10개의 파생 변수가 추가됨으로써 단순 현황 파악을 넘어선 '배송 성과 분석' 및 '고객 구매 패턴 분석'이 가능한 구조로 업그레이드되었습니다.

본 보고서의 데이터는 이후 `data/master_begin2017` 폴더의 최종 마스터 테이블을 생성하는 기초 자료로 활용되었습니다.
